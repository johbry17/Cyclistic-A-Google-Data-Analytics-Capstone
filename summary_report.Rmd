---
title: "Cyclistic"
subtitle: "Analysis of difference in ridership patterns between casual and member customers"
author: "Bryan Johns"
date: "`r format(Sys.Date(), '%Y-%m')`"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    css: ./resources/css/styles.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(ggspatial)
```

# Google Data Analytics Capstone

A hypothetical data analysis project, answering a business question for a fictional bikeshare company, analyzing customer behavior and concluding with recommendations to assist in converting casual customers into annual members.

```{r, echo=FALSE}
# load data, combine into a df
q1_2019 = read.csv("./resources/data/q1_2019_cleaned.csv")
q2_2019 = read.csv("./resources/data/q2_2019_cleaned.csv")
q3_2019 = read.csv("./resources/data/q3_2019_cleaned.csv")
q4_2019 = read.csv("./resources/data/q4_2019_cleaned.csv")
# stations = read.csv("./resources/data/stations.csv")

df <- bind_rows(q1_2019, q2_2019, q3_2019, q4_2019)
```

## Executive Summary

This report analyzes historical data on Cyclistic users to provide data-driven insights for a digital marketing campaign aimed at converting casual riders into annual members. The top three recommendations focus on leveraging existing rider behaviors to encourage membership sign-ups.

## Key Findings

- **Casual riders primarily use Cyclistic for leisure:** They take longer trips (averaging an hour) and ride mostly on weekends, particularly Saturday afternoons.

- **Annual members are predominantly commuters:** Their rides are shorter (averaging 15 minutes) and occur mainly during weekday commuting hours (8 AM and 5 PM).

- **Demographic differences:** Members tend to be slightly older, peaking in their early 30s, while casual riders peak in their early 20s.

- **Location trends:** Members’ trips are concentrated in downtown Chicago’s central business district (The Loop), while casual riders frequent popular leisure destinations.

## Key Visuals:

- Average Ride Length bar chart
```{r, echo=FALSE}
# sum average ride length by membership type
average_ride_length <- df %>%
  group_by(member_casual) %>%
  summarise(average_minutes = mean(ride_length, na.rm = TRUE))

# print(average_ride_length)

# bar chart of average ride length
ggplot(average_ride_length, aes(x = member_casual, y = average_minutes, fill = member_casual)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(average_minutes, 1)), vjust = -0.5) +
  theme_minimal() +
  labs(title = "Average Ride Length by Membership Type", y = "Average Ride Length (minutes)", x = "Rider Type")
```

- Rides per hour per day of week bar chart
```{r, echo=FALSE}
# bar chart of rides per hour by day of week, free y-axis
df %>%
  mutate(day_of_week = factor(day_of_week, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))) %>%
  group_by(hour, member_casual, day_of_week) %>%
  summarise(rides = n()) %>%
  ggplot(aes(x = hour, y = rides, fill = member_casual)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~ day_of_week, scales = "free_y") +
  theme_minimal() +
  labs(title = "Rides per Hour of Day by Customer Type and Day of Week", x = "Hour of Day", y = "Number of Rides")
```

- Top Station destinations (one chart, color-coded for casual vs member)
```{r, echo=FALSE}
# aggregate member rider counts by station
member_peak_stations <- df %>%
  filter(member_casual == "member") %>%
  count(start_station_name, sort = TRUE) %>%
  top_n(10, n)

# aggregate casual rider counts by station
casual_peak_stations <- df %>%
  filter(member_casual == "casual") %>%
  count(start_station_name, sort = TRUE) %>%
  top_n(10, n)

# convert top member start stations to sf object
member_start_sf <- member_peak_stations %>%
  left_join(df, by = c("start_station_name")) %>%
  distinct(start_station_name, start_lat, start_lng) %>%
  drop_na(start_lat, start_lng) %>%
  st_as_sf(coords = c("start_lng", "start_lat"), crs = 4326) %>%
  mutate(type = "Member")

# convert top casual start stations to sf object
casual_start_sf <- casual_peak_stations %>%
  left_join(df, by = c("start_station_name")) %>%
  distinct(start_station_name, start_lat, start_lng) %>%
  drop_na(start_lat, start_lng) %>%
  st_as_sf(coords = c("start_lng", "start_lat"), crs = 4326) %>%
  mutate(type = "Casual")

# combine the two sf objects
combined_sf <- bind_rows(member_start_sf, casual_start_sf)

# plot the map with both member and casual stations
ggplot() +
  annotation_map_tile(type = "osm", zoom = 12) +
  geom_sf(data = combined_sf, aes(color = type), size = 3, alpha = 0.7) +
  labs(title = "Top Stations for Member and Casual Riders",
       x = "Longitude", y = "Latitude", color = "Rider Type") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  scale_color_manual(values = c("Member" = "red", "Casual" = "blue"))
```


## Recommendation Summary

**Leisure-Focused Marketing:** Position membership as a way to enhance casual riders' existing leisure habits by emphasizing benefits such as unlimited rides and extended ride times.

**Targeted Digital Advertising:** Deploy ads on platforms frequented by casual riders, particularly those related to entertainment, travel, and dining, and use geo-targeted ads near high-traffic leisure stations.

**Promotional Incentives:** Offer weekend-focused memberships, seasonal discounts, referral bonuses, and strategic partnerships with major Chicago events and leisure attractions.



# Methodology

## Google's Data Analysis Framework

```{r, echo=FALSE}
knitr::include_graphics("./resources/images/six_phases_of_data_analytics.png")
```

This analysis follows the framework outlined in Google's [Data Analytics certificate](https://www.coursera.org/professional-certificates/google-data-analytics), structured as follows:

1. **Ask:** A clear statement of the business task – converting casual riders into annual members.
2. **Prepare:** Used cleaned historical data from 2019 detailing trip durations, ride frequencies, and popular station destinations.
3. **Process:** Perform and document data cleaning, manipulation, and exploratory analysis.
4. **Analyze:** A summary of the data analysis, identifying behavioral trends and differences between customer segments.
5. **Share:** Supporting visualizations and key findings.
6. **Act:** Provide top three actionable recommendations based on findings.

## Scenario

See `./resources/Case Study 1_How does a bike-share navigate speedy success.pdf`. Quoted from the Google Data Analytics Capstone:

<blockquote>You are a junior data analyst working on the marketing analyst team at Cyclistic, a bike-share
company in Chicago. The director of marketing believes the company’s future success
depends on maximizing the number of annual memberships. Therefore, your team wants to
understand how casual riders and annual members use Cyclistic bikes dierently. From these
insights, your team will design a new marketing strategy to convert casual riders into annual
members. But first, Cyclistic executives must approve your recommendations, so they must be
backed up with compelling data insights and professional data visualizations.

Characters and teams

● Cyclistic: A bike-share program that features more than 5,800 bicycles and 600
docking stations. Cyclistic sets itself apart by also offering reclining bikes, hand
tricycles, and cargo bikes, making bike-share more inclusive to people with disabilities
and riders who can’t use a standard two-wheeled bike. The majority of riders opt for
traditional bikes; about 8% of riders use the assistive options. Cyclistic users are more
likely to ride for leisure, but about 30% use the bikes to commute to work each day.

● Lily Moreno: The director of marketing and your manager. Moreno is responsible for
the development of campaigns and initiatives to promote the bike-share program.
These may include email, social media, and other channels.

● Cyclistic marketing analytics team: A team of data analysts who are responsible for
collecting, analyzing, and reporting data that helps guide Cyclistic marketing strategy.
You joined this team six months ago and have been busy learning about Cyclistic’s
mission and business goals—as well as how you, as a junior data analyst, can help
Cyclistic achieve them.

● Cyclistic executive team: The notoriously detail-oriented executive team will decide
whether to approve the recommended marketing program.

About the company

In 2016, Cyclistic launched a successful bike-share offering. Since then, the program has grown
to a fleet of 5,824 bicycles that are geotracked and locked into a network of 692 stations across
Chicago. The bikes can be unlocked from one station and returned to any other station in the
system anytime.

Until now, Cyclistic’s marketing strategy relied on building general awareness and appealing to
broad consumer segments. One approach that helped make these things possible was the
flexibility of its pricing plans: single-ride passes, full-day passes, and annual memberships.
Customers who purchase single-ride or full-day passes are referred to as casual riders.
Customers who purchase annual memberships are Cyclistic members.

Cyclistic’s finance analysts have concluded that annual members are much more profitable
than casual riders. Although the pricing flexibility helps Cyclistic attract more customers,
Moreno believes that maximizing the number of annual members will be key to future growth.
Rather than creating a marketing campaign that targets all-new customers, Moreno believes
there is a solid opportunity to convert casual riders into members. She notes that casual riders
are already aware of the Cyclistic program and have chosen Cyclistic for their mobility needs.

Moreno has set a clear goal: Design marketing strategies aimed at converting casual riders into
annual members. In order to do that, however, the team needs to better understand how
annual members and casual riders differ, why casual riders would buy a membership, and how
digital media could affect their marketing tactics. Moreno and her team are interested in
analyzing the Cyclistic historical bike trip data to identify trends.

Note that data-privacy issues prohibit you from using riders’ personally identifiable information.
This means that you won’t be able to connect pass purchases to credit card numbers to
determine if casual riders live in the Cyclistic service area or if they have purchased multiple
single passes.

Three questions will guide the future marketing program:

1. How do annual members and casual riders use Cyclistic bikes differently?
2. Why would casual riders buy Cyclistic annual memberships?
3. How can Cyclistic use digital media to influence casual riders to become members?
<br><br>

Moreno has assigned you the first question to answer: How do annual members and casual
riders use Cyclistic bikes differently?
</blockquote>

## Ask

Deliverable: A clear statement of the business task

How do annual members and casual riders use Cyclistic bikes differently? Base the analysis on Cyclistic historical bike trip data.

## Prepare

Deliverable: A description of all data sources used

Google provided the [data](https://divvy-tripdata.s3.amazonaws.com/index.html), meaning Lyft and Divvy provided them with data from Chicago.

> The [data](https://divvy-tripdata.s3.amazonaws.com/index.html) has been made available by Motivate International Inc. under this [license](https://divvybikes.com/data-license-agreement).

The analysis incorporates cleaned ride data from all four quarters of 2019, detailing trip durations, ride frequencies, station destinations, and date-time.

I used data for 2019 because it has info on gender and birthyear. Pretend that was last year and the data is current and useful.

## Process

Deliverable: Documentation of any cleaning or manipulation of data

Google provided a starter template to clean the data. See `data_cleaning_v1.R`.

Google's template covered only Q1 2019 and Q1 2020. I wanted to have all of 2019 available, so I modified the script to clean individual quarters of Cyclistic data. To join Q1 2019 and Q1 2020, Google's template removed trip duration, gender, and birth year from 2019, station latitude and longitude from 2020. I wanted to keep that info, so I dropped 2020 (lacking gender and birthyear), and added 2020's lat/lng to 2019.

Data cleaning consisted of:

● Extracting station latitude and longitude from 2020 and adding it to start and end stations in 2019 (labeling all but 366 of almost 4 million rows).

● Removing "tripduration" from 2019.

● Consolidating the "member_casual" column from four labels to two ("member" and "casual"), instead of the original two names for members ("member" and "Subscriber") and two names for casual riders ("Customer" and "casual").

● Extracting day, month, year, season, and day of the week from the start date and creating columns for each, to provide additional opportunities to aggregate the data.

● Adding a calculated field ("ride_length") for length of ride since the 2020Q1 data did not have
the "tripduration" column. This briefly catastrophically halted data analysis, as ride length was calculated in minutes for 2019, and seconds in 2020.

● Remvoing rides where ride_length shows up as negative, including several hundred rides where the company took bikes out of circulation for Quality Control reasons.

## Analyze

Deliverable: A summary of the data analysis

Casual riders' trips last approximately four times longer than those of members (one hour vs 15 mins).

Members take significantly more trips overall, with routine weekday usage.

Members peak during commuting hours; casual riders peak on weekend afternoons.

Members favor The Loop for work-related trips, while casual riders frequent leisure destinations such as Shedd Aquarium and Theater on the Lake.

See `./resources/scratch_pad.Rmd` for further insights.

## Share

Deliverable: Supporting visualizations and key findings

Refer to the [Executive Summary](#executive-summary).

```{r, echo=FALSE}
# sum average ride length by membership type
average_ride_length <- df %>%
  group_by(member_casual) %>%
  summarise(average_minutes = mean(ride_length, na.rm = TRUE))

# print(average_ride_length)

# bar chart of average ride length
ggplot(average_ride_length, aes(x = member_casual, y = average_minutes, fill = member_casual)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(average_minutes, 1)), vjust = -0.5) +
  theme_minimal() +
  labs(title = "Average Ride Length by Membership Type", y = "Average Ride Length (minutes)", x = "Rider Type")
```

There are three times more member rides than casual rides (3 million vs 1 million).

```{r, echo=FALSE}
# bar chart 0f ride frequency per user
ggplot(df, aes(x = member_casual, fill = member_casual)) +
  geom_bar() +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(title = "Total Rides by Membership Type",
       x = "Rider Type",
       y = "Total Rides") +
  theme_minimal()
```

Ridership peaks in August and nadirs in February, porportionally for both groups. Winter is dead. Crickets for activity.

```{r, echo=FALSE}
# line chart of rides per month
df %>%
  group_by(month, member_casual) %>%
  summarise(rides = n()) %>%
  ggplot(aes(x = month, y = rides, color = member_casual, group = member_casual)) +
  geom_line() +
  geom_point() +
  theme_minimal() +
  labs(title = "Rides per Month, by Customer Type", x = "Month", y = "Number of Rides")
```

Casual riders ride late morning, peaking late afternoon, especially Saturday, quite a bit Sunday. Weekend Warriors. Members have two peaks - weekdays at 8am and 5pm. Commuters. They also ride roughly the same on weekends, a gentle curve from late morning to late afternoon.

```{r, echo=FALSE}
# line chart of rides per hour
df %>%
  group_by(hour, member_casual) %>%
  summarise(rides = n()) %>%
  ggplot(aes(x = hour, y = rides, color = member_casual, group = member_casual)) +
  geom_line() +
  geom_point() +
  theme_minimal() +
  labs(title = "Rides per Hour of the Day, by Customer Type", x = "Hour", y = "Number of Rides")
```
```{r, echo=FALSE}
# bar chart of rides per hour by day of week, free y-axis
df %>%
  mutate(day_of_week = factor(day_of_week, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))) %>%
  group_by(hour, member_casual, day_of_week) %>%
  summarise(rides = n()) %>%
  ggplot(aes(x = hour, y = rides, fill = member_casual)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~ day_of_week, scales = "free_y") +
  theme_minimal() +
  labs(title = "Rides per Hour of Day by Customer Type and Day of Week", subtitle = "Free y-axis", x = "Hour of Day", y = "Number of Rides")
```

```{r, echo=FALSE}
# bar chart of rides / member_casual / day of week
df %>%
  mutate(day_of_week = factor(day_of_week, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))) %>%
  group_by(member_casual, day_of_week) %>%
  summarise(rides = n()) %>%
  ggplot(aes(x = member_casual, y = rides, fill = member_casual)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = rides), vjust = -0.5, position = position_dodge(0.9)) +
  facet_wrap(~ day_of_week) +
  theme_minimal() +
  labs(title = "Rides per Member Type by Day of Week", x = "Member Type", y = "Number of Rides") +
  scale_y_continuous(expand = expansion(mult = c(0, 0.2)))
```

Top 10 stations! Members riders go to the "Loop". They use Cyclistic for commuting to places of employment.

```{r, echo=FALSE}
# aggregate member rider counts by station
member_peak_stations <- df %>%
  filter(member_casual == "member") %>%
  count(start_station_name, sort = TRUE) %>%
  top_n(10, n)

print(member_peak_stations)

# bar chart of top stations for member riders
# ggplot(member_peak_stations, aes(x = reorder(start_station_name, n), y = n, fill = start_station_name)) +
#   geom_col(show.legend = FALSE) +
#   coord_flip() +
#   theme_minimal() +
#   labs(title = "Top Stations for Member Riders", x = "Station Name", y = "Number of Rides")
```

```{r, echo=FALSE}
# convert top member start stations to sf object
member_start_sf <- member_peak_stations %>%
  left_join(df, by = c("start_station_name")) %>% 
  distinct(start_station_name, start_lat, start_lng) %>% 
  drop_na(start_lat, start_lng) %>% 
  st_as_sf(coords = c("start_lng", "start_lat"), crs = 4326)

# plot map
ggplot() +
  annotation_map_tile(type = "osm", zoom = 12) +
  geom_sf(data = member_start_sf, color = "red", size = 3, alpha = 0.7) +
  labs(title = "Top Stations for Member Riders (Map)",
       x = "Longitude", y = "Latitude") +
  theme_minimal()
```

Casual riders seem to hit tourist / leisure destinations (I assume? Must research Chicago landmarks. "Milleniumn Park", "Shedd Aquarium", "Theater on the Lake", "Dusable Harbor", and "Adler Planetarium" sound like destinations for the occasional bike rider).

```{r,echo=FALSE}
# aggregate casual rider counts by station
casual_peak_stations <- df %>%
  filter(member_casual == "casual") %>%
  count(start_station_name, sort = TRUE) %>%
  top_n(10, n)

print(casual_peak_stations)

# bar chart of top stations for casual riders
# ggplot(casual_peak_stations, aes(x = reorder(start_station_name, n), y = n, fill = start_station_name)) +
#   geom_col(show.legend = FALSE) +
#   coord_flip() +
#   theme_minimal() +
#   labs(title = "Top Start Stations for Casual Riders", x = "Station Name", y = "Number of Rides")
```

```{r, echo=FALSE}
# map of top start stations for casual riders

# convert top casual start stations to sf object
casual_start_sf <- casual_peak_stations %>%
  left_join(df, by = c("start_station_name")) %>% # Join to get lat/lng
  distinct(start_station_name, start_lat, start_lng) %>% # Remove duplicates
  drop_na(start_lat, start_lng) %>% 
  st_as_sf(coords = c("start_lng", "start_lat"), crs = 4326)

# plot the map
ggplot() +
  annotation_map_tile(type = "osm", zoom = 12) +
  geom_sf(data = casual_start_sf, color = "blue", size = 3, alpha = 0.7) +
  labs(title = "Top Stations for Casual Riders (Map)",
       x = "Longitude", y = "Latitude") +
  theme_minimal()
```

Members are slightly older, peaking in 30-35. Casual in 25-30.

```{r, echo=FALSE}
# age distribution
ggplot(df, aes(x = 2020 - birthyear, fill = member_casual)) +
  geom_histogram(binwidth = 5, alpha = 0.7, position = "dodge") +
  # stat_bin(binwidth = 5, geom = "text", aes(label = ..count..), vjust = -0.5, position = position_dodge(5)) +
  theme_minimal() +
  labs(title = "Age Distribution by Rider Type", x = "Age", y = "Count") +
  xlim(0, 100)
```

More men ride than women. Maybe an opportunity there.

```{r, echo=FALSE}
# gender split
ggplot(df, aes(x = gender, fill = member_casual)) +
  geom_bar(position = "dodge") +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5, position = position_dodge(0.9)) +
  theme_minimal() +
  labs(title = "Gender Breakdown by Rider Type", x = "Gender", y = "Count")
```

## Act

Deliverable: Top three recommendations based on analysis

Purpose of advertising

- Position membership as an enhancement to the existing leisure experience.

- Showcase testimonials from members who use Cyclistic for recreational purposes.

- Highlight the convenience of unlimited rides, extended trip durations, and cost savings.

Advertising:

- Place ads on relevant online platforms (e.g., travel blogs, event pages, dining and entertainment guides).

- Promote Cyclistic at major Chicago events such as St. Patrick’s Day, the Chicago Blues Festival, the Air & Water Show, and Pride, offering limited-time festival passes ("Skip the traffic with a special Lollapalooza festival pass!").

- Utilize geo-targeted mobile ads near high-traffic casual rider stations with messages like “Ride unlimited this weekend – try a membership today!”

- Follow-up email marketing ("You rode three times this month. A membership would've saved you $X!").

- Engage influencers and travel vloggers to create content showcasing scenic rides and group bike tours (e.g., “Museum Ride” or “Scenic Chicago Ride”).

Promotions:

- **Weekend Membership Plans:** Introduce a “Leisure Package” offering extended weekend ride times.

- **Seasonal Discounts:** Launch summer promotions when ridership peaks.

- **Referral Bonuses:** Encourage existing members to invite friends by offering incentives. Casual riders frequently bike in groups.

- **Trial Memberships:** Offer discounted first-month trials to entice casual users ("First month free!").

- **Partnership Discounts:** Collaborate with local attractions (e.g., discounted admission to museums or restaurants for members).

- **Gamification & Rewards:** Implement a leaderboard tracking miles ridden among friends (similar to Strava) and reward milestones with merchandise or free guest passes.

Commuter crossover marketing.

- Highlight the convenience and cost-effectiveness of commuting by bike ("Beat rush hour traffic!").

- Offer free trial passes to potential commuters during peak weekday hours, 8am and 5pm.

- Establish corporate and student membership partnerships with discounts for employees and young professionals.

- Develop a transit partnership with CTA (Chicago Transit Authority) for bundled bike-and-train/bus memberships.

# Conclusion

The analysis reveals clear distinctions between casual riders and annual members, providing a strategic opportunity for conversion. By emphasizing leisure benefits, implementing targeted digital marketing, and introducing promotional incentives, Cyclistic can effectively increase membership conversion rates while enhancing the overall rider experience.